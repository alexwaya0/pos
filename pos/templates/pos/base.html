{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Amigo POS™ - {% block title %}{% endblock %}</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --darkgreen: #064420;
      --gold: #D4AF37;
      --gold-dark: #b8962c;
    }
    body { font-family: Inter, ui-sans-serif, system-ui; background: #f3f4f6; color: #111827; }
    .app-sidebar { min-height: 100vh; width: 260px; background: linear-gradient(180deg, var(--darkgreen), #0b3a2b); color: var(--gold); padding: 1.25rem; display:flex; flex-direction:column; justify-content:space-between; }
    .nav-link { display:flex; align-items:center; gap:.75rem; padding:.6rem .75rem; border-radius:.5rem; color:var(--gold); font-weight:500; text-decoration:none; }
    .nav-link:hover { background: rgba(255,255,255,0.08); }
    .nav-link.active { background: var(--gold); color: var(--darkgreen); font-weight:600; }
    .btn-primary { background:var(--gold); color:var(--darkgreen); padding:.45rem .9rem; border-radius:.5rem; font-weight:600; display:inline-flex; align-items:center; gap:.4rem; }
    .btn-primary:hover { background:var(--gold-dark); }
    .flash { display:flex; justify-content:space-between; gap:1rem; align-items:flex-start; padding:.85rem 1rem; border-radius:.5rem; background:var(--gold); color:var(--darkgreen); margin-bottom:0.75rem; }
    .flash .close { background:transparent; border:0; font-size:1rem; cursor:pointer; color:var(--darkgreen); }
    .fade-out { transition: opacity .5s ease, transform .5s ease; opacity:0; transform: translateY(-6px); }
    .app-main { flex:1; }
    .navbar { background:#fff; border-bottom:1px solid #e5e7eb; padding:.75rem 1.5rem; display:flex; justify-content:space-between; align-items:center; }
    .sidebar-footer { font-size:0.85rem; opacity:0.85; margin-top:1rem; text-align:center; }
    .sidebar-footer a { color:var(--gold); text-decoration:underline; }
  </style>
</head>
<body class="flex min-h-screen">

  {% if request.user.is_authenticated %}
  <!-- Sidebar -->
  <aside class="app-sidebar hidden lg:block">
    <div>
      <div class="brand flex gap-2 items-center mb-6">
        <div class="logo w-11 h-11 rounded-lg flex items-center justify-center font-bold text-lg bg-[rgba(255,255,255,0.08)]">AP</div>
        <div>
          <div class="text-lg font-semibold">Amigo POS™</div>
          <div class="text-sm opacity-80">Kenya • Cash POS</div>
        </div>
      </div>

      <nav class="space-y-1">
        <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}" href="{% url 'pos:dashboard' %}">
          <i data-lucide="home"></i> Dashboard
        </a>
        <a class="nav-link {% if request.resolver_match.url_name == 'sale_create' %}active{% endif %}" href="{% url 'pos:sale_create' %}">
          <i data-lucide="shopping-cart"></i> New Sale
        </a>
        <a class="nav-link {% if request.resolver_match.url_name == 'product_list' %}active{% endif %}" href="{% url 'pos:product_list' %}">
          <i data-lucide="boxes"></i> Products
        </a>
        <a class="nav-link {% if request.resolver_match.url_name == 'product_add' %}active{% endif %}" href="{% url 'pos:product_add' %}">
          <i data-lucide="plus-square"></i> Add Product
        </a>
        <a class="nav-link {% if request.resolver_match.url_name == 'reports' %}active{% endif %}" href="{% url 'pos:reports' %}">
          <i data-lucide="bar-chart-3"></i> Reports
        </a>
      </nav>
    </div>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      &copy; {% now "Y" %} – Made by <a href="https://amigohub.africa" target="_blank">Amigo Hub</a>
    </div>
  </aside>
  {% endif %}

  <!-- Main -->
  <div class="app-main flex flex-col w-full">

    <!-- Navbar -->
    {% if request.user.is_authenticated and request.resolver_match.url_name not in "login signup" %}
    <div class="navbar">
      <div class="text-lg font-semibold">{% block page_title %}Dashboard{% endblock %}</div>
      <div class="flex items-center gap-3">
        <span class="text-gray-700 font-medium">Salutations, {{ request.user.get_username }}</span>
        <form action="{% url 'pos:logout' %}" method="post">
          {% csrf_token %}
          <button type="submit" class="btn-primary"><i data-lucide="log-out"></i> Logout</button>
        </form>
      </div>
    </div>
    {% endif %}

    <!-- Content area -->
    <div class="p-6">
      <!-- Flash messages -->
      <div id="flash-wrap">
        {% if messages %}
          {% for message in messages %}
            <div class="flash" data-timeout="10000">
              <div>{{ message }}</div>
              <button class="close">✕</button>
            </div>
          {% endfor %}
        {% endif %}
      </div>

      <!-- Page content -->
      <div>
        {% block content %}{% endblock %}
      </div>
    </div>
  </div>

  <!-- JS -->
  <script>
    lucide.createIcons();
    document.querySelectorAll('.flash').forEach((el)=>{
      const timeout = parseInt(el.dataset.timeout || '10000',10);
      const t = setTimeout(()=>{ el.classList.add('fade-out'); setTimeout(()=>el.remove(),600); }, timeout);
      el.querySelector('.close').addEventListener('click', ()=>{ clearTimeout(t); el.remove(); });
    });
  </script>
</body>
</html>
